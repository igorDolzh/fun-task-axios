!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):t.FunTask=n()}(this,function(){"use strict";function t(t,n){return n={exports:{}},t(n,n.exports),n.exports}function n(t){return t instanceof m}function e(t){return"function"==typeof t}function r(t){if(!Array.isArray(t))return!1;for(var n=0;n<t.length;n++)if(!(t[n]instanceof m))return!1;return!0}function o(t){return"function"==typeof t||"object"===("undefined"==typeof t?"undefined":c(t))&&null!==t&&"function"==typeof t.then}function u(t,n,e){if(!t)throw new TypeError(n+". Actual value: "+e)}function a(t){t.prototype[i.of]=t[i.of]=t.of,t.prototype[i.empty]=t[i.empty]=t.empty,t.prototype[i.chainRec]=t[i.chainRec]=t.chainRec,t.prototype[i.concat]=t.prototype.concat,t.prototype[i.map]=t.prototype.map,t.prototype[i.bimap]=t.prototype.bimap,t.prototype[i.ap]=t.prototype.ap,t.prototype[i.chain]=t.prototype.chain}var i=t(function(t){!function(){var n={equals:"fantasy-land/equals",concat:"fantasy-land/concat",empty:"fantasy-land/empty",map:"fantasy-land/map",ap:"fantasy-land/ap",of:"fantasy-land/of",reduce:"fantasy-land/reduce",traverse:"fantasy-land/traverse",chain:"fantasy-land/chain",chainRec:"fantasy-land/chainRec",extend:"fantasy-land/extend",extract:"fantasy-land/extract",bimap:"fantasy-land/bimap",promap:"fantasy-land/promap"};"object"==typeof t&&"object"==typeof t.exports?t.exports=n:self.FantasyLand=n}()}),c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},f=(function(){function t(t){this.value=t}function n(n){function e(t,n){return new Promise(function(e,o){var i={key:t,arg:n,resolve:e,reject:o,next:null};a?a=a.next=i:(u=a=i,r(t,n))})}function r(e,u){try{var a=n[e](u),i=a.value;i instanceof t?Promise.resolve(i.value).then(function(t){r("next",t)},function(t){r("throw",t)}):o(a.done?"return":"normal",a.value)}catch(c){o("throw",c)}}function o(t,n){switch(t){case"return":u.resolve({value:n,done:!0});break;case"throw":u.reject(n);break;default:u.resolve({value:n,done:!1})}u=u.next,u?r(u.key,u.arg):a=null}var u,a;this._invoke=e,"function"!=typeof n["return"]&&(this["return"]=void 0)}return"function"==typeof Symbol&&Symbol.asyncIterator&&(n.prototype[Symbol.asyncIterator]=function(){return this}),n.prototype.next=function(t){return this._invoke("next",t)},n.prototype["throw"]=function(t){return this._invoke("throw",t)},n.prototype["return"]=function(t){return this._invoke("return",t)},{wrap:function(t){return function(){return new n(t.apply(this,arguments))}},await:function(n){return new t(n)}}}(),function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}),s=function(){function t(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(n,e,r){return e&&t(n.prototype,e),r&&t(n,r),n}}(),l=function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(t,n):t.__proto__=n)},p=function(t,n){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?t:n},y=function(t){return{type:"next",value:t}},h=function(t){return{type:"done",value:t}},_=function(t){throw t instanceof Error?t:new Error("Unhandled task failure: "+String(t))},v=function(){},k=function(t,n){var e=n.success,r=n.failure,o=n["catch"],u=v,a=v,i=function(){a(),e=v,r=v,o=v,u=v,i=v},c=t(function(t){var n=e;i(),n(t)},function(t){var n=r;i(),n(t)},o&&function(t){var n=o;i(),n(t)});return u=c.onCancel||v,a=c.onClose||v,i===v&&(u=v,a()),function(){u(),i()}},m=function(){function t(){if(f(this,t),this.constructor===t)throw new Error("Don't call `new Task()`, call `Task.create()` instead")}return s(t,[{key:"map",value:function(t){return u(e(t),"task.map(f): f is not a function",t),new O(this,t)}},{key:"mapRejected",value:function(t){return u(e(t),"task.mapRejected(f): f is not a function",t),new T(this,t)}},{key:"bimap",value:function(t,n){return u(e(t),"task.bimap(f, _): f is not a function",t),u(e(n),"task.bimap(_, f): f is not a function",n),this.map(n).mapRejected(t)}},{key:"chain",value:function(t){return u(e(t),"task.chain(f): f is not a function",t),new P(this,t)}},{key:"orElse",value:function(t){return u(e(t),"task.orElse(f): f is not a function",t),new x(this,t)}},{key:"recur",value:function(t){return u(e(t),"task.recur(f): f is not a function",t),new R(this,t)}},{key:"ap",value:function(t){var e=this;return u(n(t),"task.ap(t): t is not a task",t),t.chain(function(t){return e.map(function(n){return t(n)})})}},{key:"concat",value:function(e){return u(n(e),"task.concat(t): t is not a task",e),t.race([this,e])}},{key:"_run",value:function(){throw new Error("Method run() is not implemented in basic Task class.")}},{key:"_toString",value:function(){return"<abstract>"}},{key:"toString",value:function(){return"Task."+this._toString()}},{key:"run",value:function(t){var n="function"==typeof t?{success:t,failure:_}:{success:t.success||v,failure:t.failure||_,"catch":t["catch"]};return this._run(n)}},{key:"toPromise",value:function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{"catch":!0};return new Promise(function(e,r){t.run({success:function(t){e({success:t})},failure:function(t){e({failure:t})},"catch":n["catch"]?r:void 0})})}},{key:"runAndLog",value:function(){this.run({success:function(t){console.log("Success:",t)},failure:function(t){console.log("Failure:",t)}})}}],[{key:"create",value:function(t){return u(e(t),"Task.create(f): f is not a function",t),new d(t)}},{key:"of",value:function(t){return new g(t)}},{key:"rejected",value:function(t){return new b(t)}},{key:"empty",value:function(){return new w}},{key:"parallel",value:function(t){return u(r(t),"Task.parallel(a): a is not an array of tasks",t),new S(t)}},{key:"race",value:function(t){return u(r(t),"Task.race(a): a is not an array of tasks",t),new j(t)}},{key:"map",value:function(t,r){return u(e(t),"Task.map(f, _): f is not a function",t),u(n(r),"Task.map(_, t): t is not a task",r),new O(r,t)}},{key:"mapRejected",value:function(t,r){return u(e(t),"Task.mapRejected(f, _): f is not a function",t),u(n(r),"Task.mapRejected(_, t): t is not a task",r),new T(r,t)}},{key:"bimap",value:function(t,r,o){return u(e(t),"Task.bimap(f, _, _): f is not a function",t),u(e(r),"Task.bimap(_, f, _): f is not a function",r),u(n(o),"Task.bimap(_, _, t): t is not a task",o),o.map(r).mapRejected(t)}},{key:"chain",value:function(t,r){return u(e(t),"Task.chain(f, _): f is not a function",t),u(n(r),"Task.chain(_, t): t is not a task",r),new P(r,t)}},{key:"orElse",value:function(t,r){return u(e(t),"Task.orElse(f, _): f is not a function",t),u(n(r),"Task.orElse(_, t): t is not a task",r),new x(r,t)}},{key:"recur",value:function(t,r){return u(e(t),"Task.recur(f, _): f is not a function",t),u(n(r),"Task.recur(_, t): t is not a task",r),new R(r,t)}},{key:"chainRec",value:function(t,n){return u(e(t),"Task.chainRec(f, _): f is not a function",t),new E(t,n)}},{key:"ap",value:function(t,e){return u(n(t),"Task.ap(t, _): t is not a task",t),u(n(e),"Task.ap(_, t): t is not a task",e),t.chain(function(t){return e.map(function(n){return t(n)})})}},{key:"concat",value:function(e,r){return u(n(e),"Task.concat(t, _): t is not a task",e),u(n(r),"Task.concat(_, t): t is not a task",r),t.race([e,r])}},{key:"do",value:function(t){return u(e(t),"Task.do(f): f is not a function",t),new C(t)}},{key:"fromPromise",value:function(t){return u(o(t),"Task.fromPromise(p): p is not a promise",t),new A(t)}}]),t}();a(m);var d=function(t){function n(t){f(this,n);var e=p(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return e._computation=t,e}return l(n,t),s(n,[{key:"_run",value:function(t){var n=this._computation;return k(function(t,e,r){var o=void 0;if(r)try{o=n(t,e)}catch(u){r(u)}else o=n(t,e);return{onCancel:o||v}},t)}},{key:"_toString",value:function(){return"create(..)"}}]),n}(m),g=function(t){function n(t){f(this,n);var e=p(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return e._value=t,e}return l(n,t),s(n,[{key:"_run",value:function(t){var n=t.success;return n(this._value),v}},{key:"_toString",value:function(){return"of(..)"}}]),n}(m),b=function(t){function n(t){f(this,n);var e=p(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return e._error=t,e}return l(n,t),s(n,[{key:"_run",value:function(t){var n=t.failure;return n(this._error),v}},{key:"_toString",value:function(){return"rejected(..)"}}]),n}(m),w=function(t){function n(){return f(this,n),p(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return l(n,t),s(n,[{key:"run",value:function(){return v}},{key:"_toString",value:function(){return"empty()"}}]),n}(m),S=function(t){function n(t){f(this,n);var e=p(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return e._tasks=t,e}return l(n,t),s(n,[{key:"_run",value:function(t){var n=this;return k(function(t,e,r){var o=n._tasks.length,u=Array(o),a=0,i=function(n,i){return n.run({success:function(n){u[i]=n,a++,a===o&&t(u)},failure:e,"catch":r})},c=n._tasks.map(i);return{onClose:function(){c.forEach(function(t){return t()})}}},t)}},{key:"_toString",value:function(){return"parallel(["+this._tasks.map(function(t){return t._toString()}).join(", ")+"])"}}]),n}(m),j=function(t){function n(t){f(this,n);var e=p(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return e._tasks=t,e}return l(n,t),s(n,[{key:"_run",value:function(t){var n=this;return k(function(t,e,r){var o={success:t,failure:e,"catch":r},u=n._tasks.map(function(t){return t.run(o)});return{onClose:function(){u.forEach(function(t){return t()})}}},t)}},{key:"_toString",value:function(){return"race(["+this._tasks.map(function(t){return t._toString()}).join(", ")+"])"}}]),n}(m),O=function(t){function n(t,e){f(this,n);var r=p(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return r._task=t,r._fn=e,r}return l(n,t),s(n,[{key:"_run",value:function(t){var n=this._fn,e=t.success,r=t.failure,o=t["catch"];return this._task.run({success:function(t){function n(){return t.apply(this,arguments)}return n.toString=function(){return t.toString()},n}(function(t){var r=void 0;if(o)try{r=n(t)}catch(u){return void o(u)}else r=n(t);e(r)}),failure:r,"catch":o})}},{key:"_toString",value:function(){return this._task._toString()+".map(..)"}}]),n}(m),T=function(t){function n(t,e){f(this,n);var r=p(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return r._task=t,r._fn=e,r}return l(n,t),s(n,[{key:"_run",value:function(t){var n=this._fn,e=t.success,r=t.failure,o=t["catch"];return this._task.run({success:e,failure:function(t){function n(){return t.apply(this,arguments)}return n.toString=function(){return t.toString()},n}(function(t){var e=void 0;if(o)try{e=n(t)}catch(u){return void o(u)}else e=n(t);r(e)}),"catch":o})}},{key:"_toString",value:function(){return this._task._toString()+".mapRejected(..)"}}]),n}(m),P=function(t){function n(t,e){f(this,n);var r=p(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return r._task=t,r._fn=e,r}return l(n,t),s(n,[{key:"_run",value:function(t){var n=this._fn,e=this._task;return k(function(t,r,o){var u=v,a=!1,i=e.run({success:function(t){function n(){return t.apply(this,arguments)}return n.toString=function(){return t.toString()},n}(function(e){var i=void 0;if(o)try{i=n(e)}catch(c){o(c)}else i=n(e);i&&(u=i.run({success:t,failure:r,"catch":o}),a=!0)}),failure:r,"catch":o});return a||(u=i),{onCancel:function(){u()}}},t)}},{key:"_toString",value:function(){return this._task._toString()+".chain(..)"}}]),n}(m),x=function(t){function n(t,e){f(this,n);var r=p(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return r._task=t,r._fn=e,r}return l(n,t),s(n,[{key:"_run",value:function(t){var n=this._fn,e=this._task;return k(function(t,r,o){var u=v,a=!1,i=e.run({success:t,failure:function(t){function n(){return t.apply(this,arguments)}return n.toString=function(){return t.toString()},n}(function(e){var i=void 0;if(o)try{i=n(e)}catch(c){o(c)}else i=n(e);i&&(u=i.run({success:t,failure:r,"catch":o}),a=!0)}),"catch":o});return a||(u=i),{onCancel:function(){u()}}},t)}},{key:"_toString",value:function(){return this._task._toString()+".orElse(..)"}}]),n}(m),R=function(t){function n(t,e){f(this,n);var r=p(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return r._task=t,r._fn=e,r}return l(n,t),s(n,[{key:"_run",value:function(t){var n=this._fn,e=this._task;return k(function(t,r,o){var u=void 0,a=!1,i=!1,c=!1,f=v,s=function p(t){if(a=!0,u=t,!i){for(i=!0;a;){a=!1;var e=void 0;if(o)try{e=n(u)}catch(s){o(s)}else e=n(u);e&&(f=e.run({success:p,failure:r,"catch":o}),c=!0)}i=!1}},l=e.run({success:s,failure:r,"catch":o});return c||(f=l),{onCancel:function(){f()}}},t)}},{key:"_toString",value:function(){return this._task._toString()+".recur(..)"}}]),n}(m),E=function(t){function n(t,e){f(this,n);var r=p(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return r._fn=t,r._initial=e,r}return l(n,t),s(n,[{key:"_run",value:function(t){var n=this._fn,e=this._initial;return k(function(t,r,o){var u=null,a=!1,i=!1,c=v,f=function s(e){if("done"===e.type)return void t(e.value);if(u=e.value,a=!0,!i){for(i=!0;a;){a=!1;var f=void 0;if(o)try{f=n(y,h,u)}catch(l){o(l)}else f=n(y,h,u);f&&(c=f.run({success:s,failure:r,"catch":o}))}i=!1}};return f(y(e)),{onCancel:function(){c()}}},t)}},{key:"_toString",value:function(){return"chainRec(..)"}}]),n}(m),C=function(t){function n(t){f(this,n);var e=p(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return e._generator=t,e}return l(n,t),s(n,[{key:"_run",value:function(t){var n=this._generator;return k(function(t,e,r){var o=n(),u=void 0,a=!1,i=!1,c=v,f=function s(n){if(a=!0,u=n,!i){for(i=!0;a;){a=!1;var f=void 0;if(r)try{f=o.next(u)}catch(l){r(l)}else f=o.next(u);if(f){var p=f,y=p.value,h=p.done;c=y.run({success:h?t:s,failure:e,"catch":r})}}i=!1}};return f(void 0),{onCancel:function(){c()}}},t)}},{key:"_toString",value:function(){return"do(..)"}}]),n}(m),A=function(t){function n(t){f(this,n);var e=p(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return e._promise=t,e}return l(n,t),s(n,[{key:"_run",value:function(t){var n=this._promise,e="function"==typeof n?n():n;return k(function(t,n,r){return e.then(t,r),{}},t)}},{key:"_toString",value:function(){return"fromPromise(..)"}}]),n}(m);return m});